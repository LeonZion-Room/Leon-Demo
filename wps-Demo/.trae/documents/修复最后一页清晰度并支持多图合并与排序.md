## 问题与目标
- 修复最后一页清晰度低：统一缩放与嵌入策略，避免将 PDF 点当作像素导致二次缩小。
- 支持一次性加入多张图片并可调整顺序：批量选择、缩略图预览、拖拽排序，按设定纸张/边距生成 PDF。

## 原因定位（代码参考）
- 单页正常：对每段 `seg` 直接以原像素数据嵌入 PDF 指定矩形，显示清晰。
- 最后一页不清晰：在 `compose_pdf_from_segments` 和 `_GenerateWorker.run` 的“最后一页”分支中将图片先用 PIL 按 `target_w/target_h` 生成白底画布并 `resize` 到 `draw_w/draw_h`，这些值是 PDF 点（72dpi），被当作像素用，造成过度缩小，清晰度下降（参考 img2pdf.py:122–141、209–230）。

## 修复方案（清晰度）
1. 移除“最后一页”特殊画布与 `resize`，采用与其它页完全一致的流程：
   - 将原始 `seg` 直接保存到内存（PNG/JPEG），用 `page.insert_image(rect, stream=...)` 按 `rect` 缩放显示。
   - PDF 页面默认背景为白色，原先的“白底填充”不再需要。
2. 保持最高清晰度：不在嵌入前对像素做 `resize`；只由 PDF 显示进行几何缩放。
3. 若用户希望控制尺寸策略，后续可增加“适配模式”选择：适配宽/适配高/不缩放（此次先统一保持当前等比适配逻辑）。

## 新增功能（多图合并 + 排序）
1. 批量选择：新增“添加图片”按钮，使用 `QFileDialog.getOpenFileNames` 支持一次选多张。
2. 图片列表与缩略图：新增 `QListWidget` 展示所选图片缩略图与文件名。
3. 拖拽排序：启用内部拖拽排序（`InternalMove`），根据列表顺序生成 PDF。
4. 生成逻辑：对每张图片创建一页，采用与当前分段页相同的“纸张/横向/边距/居中适配”与 `insert_image(rect)` 方式。
5. 预览与页数：列表点击联动主预览，页信息显示基于当前列表顺序和总数。

## UI/交互调整
- 模式切换：新增源类型选择（“长图裁剪”“多图合并”）。
  - 长图裁剪：沿用现有裁剪高度、页预览与生成。
  - 多图合并：隐藏裁剪控件，显示图片列表与拖拽排序，生成一页/图。
- 输出路径默认：多图模式默认生成 `merged.pdf` 到首图目录（可修改）。

## 具体改动点（img2pdf.py）
- 移除最后一页特殊分支并统一嵌入：
  - 删除或改造 `compose_pdf_from_segments` 中 122–141 行的白底/resize 分支，改为与 138–142 行同一路径；
  - 删除或改造 `_GenerateWorker.run` 中 209–230 行的白底/resize 分支，改为与 225–229 行同一路径。
- 添加多图模式：
  - 状态：`self.mode = 'single_long' | 'multi_images'`；`self.image_paths: List[str]`；
  - 选择：新增 `_choose_images()` 使用 `getOpenFileNames`；
  - 列表：新增 `self.list_images`（缩略图、`InternalMove` 拖拽），维护顺序；
  - 生成：新增 `_GenerateImagesWorker` 或在 `_start_generate` 中分支调用合并逻辑（逐图创建 PDF 页并 `insert_image`）。
  - 预览：在多图模式下点击图片项更新 `preview_label`。

## 适配与缩放保持
- 继续使用现有纸张/横向/边距计算：`_page_size` 与 `target_w/target_h` 几何适配。
- 不做像素级缩放，仅用 PDF `rect` 控制显示尺寸，保留原图分辨率。
- 缩略图预览仍使用 `pil_to_qpixmap` 并在 UI 中用 `scaledToHeight(..., SmoothTransformation)`。

## 验证用例
- 长图：裁剪生成多页，最后一页与前面一致清晰；
- 多图：选择 3 张不同尺寸图片，拖拽变更顺序后生成，页面居中适配、无清晰度损失；
- 边界：超大图、横向纸张、不同边距设置下效果正确。

## 交付与影响范围
- 仅改动 `img2pdf.py`，不新增外部依赖；沿用 PyMuPDF/Pillow/PySide6。
- UI 改动局限在该窗口内部，样式沿用 `ui_style_nb`。