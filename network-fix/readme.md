# 背景
- 我是一个 Python 程序员

# 具体需求
- 希望能完成一个 windows的小插件
- 我希望能在启动的时候自动获取管理员权限
- 能自动检测所有的有线连接和无线连接，然后检查是否存在固定IP，如果有固定IP就自动清除换成自动分配
- 然后会自动关闭所有有线连接和无线连接，会自动断开，再自动重连



# 开发细节
- 我的开发环境是 windows11，尽量使用powershell进行操作
- 我希望你用 .venv 的相对路径进行环境的激活,如 下载库使用 .venv\Scripts\pip install  xxxxxx；运行软件使用.venv\Scripts\python main.py 运行软件
- 希望所有 Pip install 使用阿里云镜像- https://mirrors.aliyun.com/pypi/simple/

## 使用说明

- 开发环境：Windows 11，Python 3.8+。
- 依赖：`wmi`（通过 Python 的 WMI 接口操作网卡）。
 - 依赖：`PyQt5`（基于 PyQt5 的蓝黑极简 GUI）。

### 准备虚拟环境
- 创建虚拟环境：`python -m venv .venv`
- 安装依赖（阿里云镜像）：
  - `.venv\Scripts\pip install -i https://mirrors.aliyun.com/pypi/simple/ PyQt5 wmi`
  - 首次运行如检测到缺少 `PyQt5` 或 `wmi`，程序会尝试使用 `.venv\Scripts\pip` 与阿里云镜像自动安装，安装后请重新运行脚本。

### 运行
- 执行：`.venv\Scripts\python main.py`
- 程序会自动触发 UAC 提升为管理员权限，并打开可视化窗口：
  - 顶部按钮区：`开始修复`、`退出`；
  - 选项：`自动连接最强已保存 Wi-Fi`（默认启用）；
  - 选项：`自动连接最强有线`（默认启用，按是否已获 IP 与速度选择）；
  - 状态与进度条：实时显示当前步骤与总体进度；
  - 日志区域：滚动输出每个网卡的处理日志与返回码。
- 点击 `开始修复` 后，程序将：
  - 枚举所有物理有线与无线网卡（以太网/802.11）；
  - 检测是否存在静态 IPv4；如存在，切换为 DHCP，重置 DNS 为自动；
  - 依次禁用并启用网卡，实现断开再重连，并尝试续租 DHCP；
  - 若开启选项，将自动扫描附近 Wi-Fi 并连接信号最强的“已保存配置”网络；
  - 若开启选项，将自动选择“最强有线”（优先已获 IP，再按速度最高）并尝试续租 DHCP；
  - 完成后窗口保持打开，不会自动退出，便于查看结果。

### 注意事项
- 运行期间网络将短暂中断，请在可接受的时段执行。
- WMI 的 `EnableDHCP` 针对 IPv4；IPv6 通常依赖路由器自动配置，不在本工具强制修改范围。
- 如出现无物理网卡的提示，检查设备管理器或确保网卡未被禁用。
- 自动连接使用系统 `netsh wlan` 命令：
  - 从“已保存配置”中筛选；
  - 扫描附近网络（按 BSSID 信号百分比）并选择信号最强的匹配项；
  - 若系统存在多个 Wi-Fi 接口，默认取第一个接口发起连接。
 - 有线自动连接使用 WMI：
   - 排除蓝牙等虚拟适配器；
   - 在以太网接口中优先选择已获 IP 的接口，其次按速度（如 1Gbps/10Gbps）；
   - 尝试启用接口、切换 DHCP、续租；若未确认获 IP，建议检查网线与交换机端口。

